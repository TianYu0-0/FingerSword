# 指尖剑仙 - 阿里云 ESA Pages 部署指南

## 项目概述

**项目名称**: 指尖剑仙 (FingerSword)  
**技术框架**: Nuxt 3 + Vue 3  
**构建工具**: Vite  
**部署目标**: 阿里云 ESA (边缘安全加速) Pages

---

## 阿里云 ESA Pages 详细部署步骤

### 前置准备

1. **阿里云账号**: 需要已实名认证的阿里云账号
2. **开通 ESA 服务**: 首次使用需开通边缘安全加速服务
3. **GitHub 账号**: 用于代码托管（推荐方式）

### 第一步：准备代码仓库

#### 1.1 初始化 Git 仓库

```bash
# 进入项目目录
cd d:\Source\ESAPages\FingerSword

# 初始化 Git 仓库
git init

# 添加所有文件到暂存区
git add .

# 提交代码
git commit -m "feat: 指尖剑仙游戏 v0.1.0 - 御剑入门版"
```

#### 1.2 创建 GitHub 仓库并推送

1. 登录 [GitHub](https://github.com)
2. 点击右上角 **+** → **New repository**
3. 填写仓库信息：
   - Repository name: `FingerSword`
   - Description: `指尖剑仙 - 手势控制仙侠游戏`
   - 选择 **Public** 或 **Private**
4. 点击 **Create repository**
5. 推送代码：

```bash
# 添加远程仓库（替换 YOUR_USERNAME）
git remote add origin https://github.com/YOUR_USERNAME/FingerSword.git

# 推送到 main 分支
git branch -M main
git push -u origin main
```

### 第二步：登录阿里云 ESA 控制台

1. 打开浏览器访问: https://esa.console.aliyun.com/
2. 使用阿里云账号登录
3. 如果首次使用，按提示开通 ESA 服务

### 第三步：创建 ESA 站点（重要！）

> ⚠️ **注意**: 使用 Pages 功能前，必须先创建一个 ESA 站点

#### 3.1 添加站点

1. 在 ESA 控制台左侧菜单点击 **站点管理** → **添加站点**
2. 输入站点信息：
   - **站点名称**: `fingersword` 或你的域名
   - **站点类型**: 选择 **CNAME 接入** 或 **NS 接入**
   - 如果没有自己的域名，可以选择 **CNAME 接入** 并使用测试域名
3. 选择套餐：
   - 可选择 **免费版** 或 **基础版**（Pages 功能需要基础版以上）
4. 点击 **确定** 创建站点

#### 3.2 等待站点生效

- 站点创建后状态会显示为 **待验证** 或 **生效中**
- CNAME 接入需要配置 DNS 解析
- NS 接入需要修改域名 NS 服务器

#### 3.3 站点配置说明

| 接入方式 | 说明 | 适用场景 |
|---------|------|---------|
| **CNAME 接入** | 添加 CNAME 记录指向阿里云 | 已有域名，快速接入 |
| **NS 接入** | 将域名 NS 改为阿里云 | 需要完整功能 |

### 第四步：创建 Pages 项目

#### 4.1 进入 Pages 功能

1. 在已创建的站点中，点击站点名称进入站点详情
2. 在左侧菜单找到 **Pages** 或 **边缘函数/Pages**
3. 点击 **创建项目** 或 **新建 Pages 项目**

#### 4.2 选择部署方式

选择 **从 Git 仓库导入**（推荐）

#### 4.3 关联 GitHub 账号

1. 点击 **连接 GitHub**
2. 在弹出的 GitHub 授权页面，点击 **Authorize**
3. 选择要授权的仓库（可以选择 All repositories 或指定仓库）
4. 完成授权后返回阿里云控制台

#### 4.4 选择仓库和分支

1. 在仓库列表中找到 `FingerSword`
2. 选择部署分支: `main`
3. 点击 **下一步**

### 第五步：配置构建设置

#### 5.1 框架预设

选择 **Nuxt.js** 或 **Nuxt 3**

#### 5.2 构建配置

| 配置项 | 值 |
|--------|-----|
| **构建命令** | `npm run build` |
| **输出目录** | `.output/public` |
| **安装命令** | `npm install` |
| **Node.js 版本** | `18` 或 `18.x` |

#### 5.3 环境变量（可选）

如果需要，可以添加环境变量：
- 点击 **添加环境变量**
- 目前本项目不需要额外环境变量

#### 5.4 高级设置（可选）

- **根目录**: 留空（使用仓库根目录）
- **构建缓存**: 开启（加速后续构建）

### 第六步：开始部署

1. 确认所有配置无误
2. 点击 **部署** 或 **开始部署**
3. 等待构建和部署完成（通常 2-5 分钟）

### 第七步：查看部署结果

#### 6.1 部署成功

部署成功后，系统会自动分配一个域名，格式类似：
```
https://fingersword-xxxx.pages.dev
```

#### 6.2 访问验证

1. 点击分配的域名链接
2. 验证首页正常加载
3. 测试游戏功能
4. 测试教学关卡

### 第八步：绑定自定义域名（可选）

1. 在项目设置中找到 **自定义域名**
2. 点击 **添加域名**
3. 输入你的域名（如 `game.yourdomain.com`）
4. 按提示配置 DNS CNAME 记录
5. 等待 DNS 生效（通常几分钟到几小时）

---

## 备选方案：本地构建上传

#### 1. 本地构建

```bash
# 安装依赖
npm install

# 构建生产版本
npm run build
```

构建完成后，静态文件位于 `.output/public` 目录。

#### 2. 上传到 ESA Pages

1. 登录阿里云 ESA 控制台
2. 进入 Pages → 创建项目
3. 选择 **直接上传**
4. 上传 `.output/public` 目录下的所有文件
5. 完成部署

## 部署到 Netlify（备选方案）

### 自动部署

```bash
# 安装 Netlify CLI
npm install -g netlify-cli

# 登录 Netlify
netlify login

# 初始化项目
netlify init

# 部署到生产环境
netlify deploy --prod
```

### 手动部署

1. 运行 `npm run build`
2. 访问 [Netlify](https://app.netlify.com/)
3. 拖拽 `.output/public` 文件夹到 Netlify 界面

## 构建配置文件

### nuxt.config.ts

```typescript
export default defineNuxtConfig({
  compatibilityDate: '2024-12-20',
  devtools: { enabled: false }, // 生产环境关闭
  modules: [],
  app: {
    head: {
      title: '指尖剑仙 - 以指御剑，斩妖除魔',
      // ...
    }
  },
  css: ['~/assets/css/main.css'],
})
```

### netlify.toml

```toml
[build]
  command = "npm run build"
  publish = ".output/public"

[build.environment]
  NODE_VERSION = "18"

[[redirects]]
  from = "/*"
  to = "/index.html"
  status = 200
```

## 环境要求

- **Node.js**: >= 18.x
- **npm**: >= 9.x
- **构建内存**: >= 1GB

## 部署检查清单

- [ ] 确认所有依赖已安装 (`npm install`)
- [ ] 本地构建成功 (`npm run build`)
- [ ] 本地预览正常 (`npm run preview`)
- [ ] Git 仓库已推送最新代码
- [ ] ESA Pages / Netlify 账号已配置
- [ ] 域名已绑定（可选）

## 常见问题

### Q1: 构建失败 - 内存不足

增加 Node.js 内存限制：
```bash
NODE_OPTIONS="--max-old-space-size=4096" npm run build
```

### Q2: 页面刷新 404

确保配置了 SPA 重定向规则（netlify.toml 中的 redirects 配置）。

### Q3: 资源加载失败

检查 `nuxt.config.ts` 中的 `app.baseURL` 配置是否正确。

## 部署后验证

1. 访问部署的 URL
2. 测试首页加载
3. 测试游戏页面功能
4. 测试教学关卡
5. 验证手势识别（需要摄像头权限）

## 联系方式

如有部署问题，请提交 Issue 或联系开发团队。
