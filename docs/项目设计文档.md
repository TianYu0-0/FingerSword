# 剑仙修炼场 - 项目设计文档

## 项目概述

**项目名称：** 指尖剑仙（FingerSword）

**Slogan：** "以指御剑，斩妖除魔"

**项目简介：** 一款基于手势识别的仙侠风格互动游戏，用户可以通过鼠标或摄像头手势控制仙剑完成各种挑战任务。

**在线访问：** [https://game.tsyewz.top](https://game.tsyewz.top)

**部署平台：** 阿里云 ESA Pages

**GitHub 仓库：** [finger-sword](https://github.com/YOUR_USERNAME/finger-sword)（待更新）

## 核心特色

- 双控制模式：鼠标 + 摄像头手势识别
- 仙侠国风视觉风格
- 多种游戏关卡
- 万剑归宗特色玩法

## 控制方式

用户可在游戏中切换控制模式，适配不同设备和使用场景。默认使用手势模式以提供更沉浸的体验。

### 1. 鼠标模式（桌面端）
| 操作 | 动作 |
|------|------|
| 移动鼠标 | 控制剑的位置和方向 |
| 左键单击 | 剑气斩击（单次攻击） |
| 左键长按 | 蓄力斩（蓄力越久伤害越高） |
| 左键双击 | 瞬移突刺（剑快速冲向点击位置） |
| 右键单击 | 剑气冲击波（范围攻击） |
| 右键长按 | 聚剑（万剑归宗模式） |
| 右键松开 | 万剑齐发 |
| 滚轮向上 | 剑阵顺时针旋转 |
| 滚轮向下 | 剑阵逆时针旋转 |
| 滚轮点击 | 剑阵散开/收拢切换 |
| 左右键同按 | 剑气护盾（防御姿态） |
| 快速移动鼠标 | 剑气横扫（划出轨迹攻击） |

### 2. 手势模式（默认模式）

基于 MediaPipe Hands 的实时手势识别系统，通过摄像头捕捉手部动作控制游戏。

| 手势 | 动作 | 说明 |
|------|------|------|
| 👆 食指指向 | 控制剑位置 | 食指伸直，其他手指弯曲 |
| ✌️ 双指并拢保持3秒 | 聚剑 | 食指和中指伸直并拢，保持3秒触发 |
| ✌️ 结束双指并拢 | 万剑齐发 | 从双指并拢变为其他手势时触发 |
| ✊ 握拳保持3秒 | 开始蓄力 | 所有手指弯曲握拳，保持3秒触发 |
| 🖐️ 张开手掌 | 释放蓄力 | 所有手指伸直张开，释放已蓄力的攻击 |

**技术特性：**
- 手势稳定性检查：需要连续2帧识别相同手势才触发
- 动作冷却系统：防止误触发（斩击300ms、剑气波500ms、突刺800ms、万剑齐发1000ms）
- 置信度评分：综合手部检测置信度和手势识别置信度，只有超过0.5才触发
- 实时调试日志：便于问题排查和优化

**使用要求：**
- 需要摄像头权限
- 建议使用 HTTPS 或 localhost 访问
- 光线充足的环境下识别效果更佳

### 控制模式对比
| 模式 | 精准度 | 沉浸感 | 适用场景 |
|------|--------|--------|----------|
| 鼠标 | ⭐⭐⭐⭐⭐ | ⭐⭐⭐ | 桌面端精准操作 |
| 手势 | ⭐⭐⭐ | ⭐⭐⭐⭐⭐ | 体验展示、趣味玩法（默认） |

## 关卡设计

### 1. 御剑入门 ⭐
- **玩法：** 单剑控制教学
- **目标：** 熟悉基本操作
- **内容：** 引导用户控制剑移动到指定位置

### 2. 御剑斩妖 ⭐⭐
- **玩法：** 屏幕随机出现妖怪/靶子
- **目标：** 用剑划过击杀，限时挑战
- **计分：** 击杀数量 + 连击加分

### 3. 剑阵修炼 ⭐⭐
- **玩法：** 屏幕显示轨迹路线（剑诀图案）
- **目标：** 沿轨迹划动
- **计分：** 精准度评分

### 4. 万剑归宗 ⭐⭐⭐
- **玩法：** 控制数十把剑聚拢、移动、释放
- **目标：** 聚剑后瞄准目标万剑齐发
- **计分：** 剑数量 × 命中数

### 5. 剑雨天降 ⭐⭐⭐
- **玩法：** 控制剑群在空中移动
- **目标：** 对准地面目标释放剑雨
- **计分：** 覆盖范围 + 命中率

### 6. 万剑护体 ⭐⭐⭐⭐
- **玩法：** 剑环绕形成剑阵
- **目标：** 抵挡四面八方的攻击
- **计分：** 存活时间 + 拦截数

## 用户引导系统

### 首次进入引导

#### 欢迎页面
- 水墨动画展示项目 Logo 和名称
- "以指御剑，斩妖除魔" Slogan 书法动画
- "开始修炼" 按钮进入下一步

#### 控制模式选择
- 展示两种控制模式卡片
- 每种模式配有简短说明和图示
- 推荐手势模式（标注"推荐"印章）
- 手势模式提示需要摄像头权限
- 选择后可随时在游戏中切换

#### 摄像头权限引导（手势模式）
- 说明为何需要摄像头权限
- 展示手势识别预览效果
- 提供"允许"和"稍后再说"选项
- 拒绝后自动切换到鼠标模式

### 操作教学引导

#### 基础操作教学（御剑入门关卡内）

**第一步：移动剑**
- 高亮提示区域："移动鼠标/食指指向 控制剑的位置"
- 屏幕出现目标光圈，引导剑移动到指定位置
- 完成后显示"御剑初成"

**第二步：剑气斩击**
- 提示："左键单击/食指快速划动 释放剑气"
- 出现练习靶子，引导用户攻击
- 完成后显示"剑气凌厉"

**第三步：蓄力斩**
- 提示："握拳保持3秒 开始蓄力"
- 蓄力条可视化显示
- 提示："张开手掌 释放蓄力"
- 完成后显示"气贯长虹"

**第四步：聚剑与万剑齐发**
- 提示："双指并拢保持3秒 聚拢剑阵"
- 多把剑从四周飞来聚拢
- 提示："结束双指并拢 万剑齐发"
- 完成后显示"万剑归宗"

#### 教学完成
- 显示"恭喜少侠，御剑入门！"
- 展示已学会的技能列表
- "进入江湖" 按钮开始正式游戏

### 关卡引导

#### 关卡开始前
- 显示关卡名称（书法动画）
- 简要说明关卡目标和玩法
- 展示本关卡会用到的操作提示
- "开始" 按钮进入关卡

#### 关卡内提示
- 首次遇到新机制时暂停并提示
- 屏幕边缘显示当前可用操作图标
- 连击时显示鼓励文字（"好！"、"妙！"、"绝！"）

#### 关卡结束
- 显示得分和评价（D/C/B/A/S）
- 展示本关统计（击杀数、命中率、最高连击）
- "重新挑战" / "下一关" 按钮

### 提示系统

#### 常驻提示
- 屏幕角落显示当前控制模式图标
- 按 H 键或点击"?"图标显示操作帮助
- 暂停菜单中可查看完整操作说明

#### 智能提示
- 长时间无操作：显示"移动鼠标控制剑"
- 多次失败：显示相关技能提示
- 发现新功能：弹出简短说明气泡

#### 提示偏好设置
- 可关闭新手提示
- 可调整提示频率（详细/简洁/关闭）
- 可重新观看教学

## 视觉设计

### 整体风格
- **国画水墨画风**
- 色调：水墨黑白为主，点缀朱红、藏青、赭石
- 笔触：毛笔质感，晕染效果
- 留白：大量留白，意境悠远

### 背景场景
- 水墨山水：远山淡墨，近景浓墨
- 云雾缭绕：墨色渐变晕染
- 竹林松柏：写意笔触
- 飞瀑流泉：动态水墨效果

### 剑的设计
- 水墨笔触绘制的剑形
- 剑身：墨色渐变，边缘晕染
- 剑光：淡墨光晕效果
- 移动时：墨迹拖尾，如毛笔划过宣纸

### 特效风格
| 场景 | 特效 |
|------|------|
| 剑移动 | 墨迹拖尾，笔触飞白效果 |
| 聚剑 | 墨色漩涡，水墨晕染扩散 |
| 万剑齐发 | 泼墨效果，墨点飞溅 |
| 命中目标 | 墨花绽放，宣纸浸染效果 |
| 连击 | 书法数字，朱红印章风格 |

### 配色方案
| 元素 | 颜色 |
|------|------|
| 背景 | 宣纸米白 #F5F0E6 |
| 主墨色 | 浓墨黑 #1A1A1A |
| 淡墨 | 灰墨 #6B6B6B |
| 点缀色 | 朱红 #C41E3A |
| 辅助色 | 藏青 #2E4A62 |

### UI 元素
- 按钮：印章风格，朱红底色
- 文字：书法字体（如"站酷仓耳渔阳体"）
- 边框：毛笔勾勒效果
- 图标：水墨简笔画风格

## 技术架构

### 前端框架
- Nuxt 3 + Vue 3
- TypeScript
- Tailwind CSS

### 核心技术
| 功能 | 技术方案 |
|------|----------|
| 手势识别 | MediaPipe Hands |
| 游戏渲染 | Canvas 2D |
| 粒子特效 | 自定义粒子系统 |
| 音效 | Web Audio API |
| 状态管理 | Vue 3 Composition API |

### 手势识别系统架构

**识别流程：**
1. 摄像头捕获视频流（640x480）
2. MediaPipe Hands 检测手部并提取21个关键点
3. 基于关键点位置计算手指伸直/弯曲状态
4. 识别手势类型并计算置信度
5. 手势稳定性检查（连续2帧相同）
6. 映射到游戏动作并触发回调

**手势识别算法：**
- **食指指向**：只有食指伸直，其他手指弯曲
- **双指并拢**：食指和中指伸直，无名指和小指弯曲
- **握拳**：所有手指弯曲，弯曲度小于0.1
- **张开手掌**：所有手指伸直，伸直度大于0.08
- **竖大拇指**：只有拇指伸直（多维度距离判断）

**动作映射系统：**
- 时间触发：双指并拢/握拳需保持3秒
- 状态转换：手势变化时触发特定动作
- 冷却机制：每个动作有独立的冷却时间
- 置信度过滤：只有置信度>0.5的手势才触发动作

**Composables 架构：**
- `useGesture.ts`：手势识别引擎，处理 MediaPipe 集成
- `useGestureActions.ts`：动作映射层，处理手势到游戏动作的转换
- `pages/game.vue`：游戏主逻辑，连接手势系统和游戏画布

### 性能优化
- 对象池管理剑实例
- Canvas 批量渲染
- requestAnimationFrame 动画循环
- 手势识别节流处理

## 扩展功能（可选）

### 成就系统
- 解锁不同剑的皮肤
- 获得称号（剑仙、剑圣、剑神等）

## 项目结构（预设）

```
FingerSword/
├── assets/           # 静态资源（图片、音效）
├── components/       # Vue 组件
│   ├── game/         # 游戏相关组件
│   └── ui/           # UI 组件
├── composables/      # 组合式函数
│   ├── useGesture.ts # 手势识别
│   ├── useSword.ts   # 剑控制逻辑
│   └── useGame.ts    # 游戏状态管理
├── pages/            # 页面
├── public/           # 公共资源
├── stores/           # Pinia 状态
└── types/            # TypeScript 类型定义
```

## 开发计划

### 第一阶段：基础框架
- [x] 项目初始化（Nuxt 3）
- [x] 基础 UI 布局
- [x] Canvas 游戏画布

### 第二阶段：核心功能
- [x] 鼠标控制剑移动
- [x] 剑的渲染和拖尾特效
- [x] MediaPipe 手势识别集成

### 第三阶段：关卡开发
- [x] 御剑入门关卡
- [ ] 御剑斩妖关卡
- [ ] 万剑归宗关卡

### 第四阶段：完善优化
- [x] 视觉特效优化
- [x] 音效添加
- [x] 性能优化（公共渲染逻辑抽取）
- [x] 移动端适配（触摸事件支持）
- [x] 手势控制集成

### 第五阶段：部署上线
- [x] 部署配置准备（netlify.toml, README.md）
- [x] 部署到阿里云 ESA Pages
- [x] 自定义域名绑定（game.tsyewz.top）
- [x] SSL 证书配置
- [x] 自动部署流程配置
- [ ] 提交参赛

## 部署信息

### 生产环境

**访问地址：** [https://game.tsyewz.top](https://game.tsyewz.top)

**部署平台：** 阿里云 ESA Pages

**部署方式：** Git 仓库自动部署

**构建配置：**
- 构建命令：`npm run build`
- 输出目录：`.output/public`
- Node.js 版本：18.x

### 域名配置

**主域名：** tsyewz.top
**游戏域名：** game.tsyewz.top
**DNS 解析：** 阿里云云解析 DNS
**接入方式：** CNAME 接入
**SSL 证书：** Let's Encrypt 自动申请

### 自动部署流程

1. 推送代码到 `master` 分支
2. ESA Pages 自动触发构建
3. 执行 `npm install` 和 `npm run build`
4. 部署到边缘节点
5. 自动刷新 CDN 缓存

### 性能优化

- **边缘加速：** 阿里云 ESA 全球边缘节点
- **静态资源：** CDN 加速分发
- **HTTPS：** 全站 HTTPS 加密
- **缓存策略：** 静态资源长期缓存

### 监控与维护

- **部署状态：** ESA Pages 控制台实时监控
- **访问日志：** ESA 提供访问分析
- **错误追踪：** 浏览器控制台日志
- **性能监控：** Web Vitals 指标

详细部署步骤请参考：[部署指南](./部署指南.md)
